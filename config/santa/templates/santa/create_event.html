{% extends "santa/base.html" %}

{% block title %}Create Event{% endblock %}
{% block content %}
    <div class="card">

        <div class="event_form">

            <form method="post">
                {% csrf_token %}

                <p class="sub"> Set Up Your Secret Santa </p>

                <div class="form-group">
                    Event Name
                    <input type="text" class="form-control" name="event_name" value="{{ saved_event.event_name|default:'' }}"
                        placeholder="Family Secret Santa"required>
                </div>
                    
                <div class="form-group">        
                    Gift Exchange Date
                    <input type="date" name="event_date" class="form-control" value="{{ saved_event.event_date|default:'' }}" required>
                </div>
                <div class="form-group"> 
                    Time
                    <input type="time" name="event_time" class="form-control" value="{{ saved_event.event_time|default:'' }}">
                </div>    
                <div class="form-group">     
                    Location
                    <input type="text" name="event_location" class="form-control" value="{{ saved_event.event_location|default:'' }}">
                    </div>
                <div class="form-group">     
                    Suggested Budget for the Gift 
                    <input type="text" name="event_budget" class="form-control" value="{{ saved_event.event_budget|default:'' }}">
                    </div>


                    Who is participating in this event?
                    <div class="form-group"> 
                    <input type="text" class="form-control" name="p1" 
                        value="{{ organizer_name }}" readonly> <!-- Include the organizer's name automatically -->
                    <input type="email" class="form-control" name="p1_email"
                        value="{{ organizer_email }}" readonly>
                    </div>
                    <div class="form-group">     
                    <input type="text" class="form-control" name="p2" value="{{ saved_participants.1.name|default:'' }}"
                        placeholder="Name 2" required>
                    <input type="email" class="form-control" name="p2_email" value="{{ saved_participants.1.email|default:'' }}"
                        placeholder="Name 2 Email" required>
                        </div>
                    <div class="form-group"> 
                    <input type="text" class="form-control" name="p3" placeholder="Name 3" value="{{ saved_participants.2.name|default:'' }}" required>
                    <input type="email" class="form-control" name="p3_email" value="{{ saved_participants.2.email|default:'' }}"
                        placeholder="Name 3 Email" required>
                        </div>
                    <div class="form-group"> 
                    <input type="text" class="form-control" name="p4" value="{{ saved_participants.3.name|default:'' }}"
                        placeholder="Name 4" required>
                    <input type="email" class="form-control" name="p4_email" value="{{ saved_participants.3.email|default:'' }}" 
                        placeholder="Name 4 Email" required>
                        </div>

                    <div class="extras" id="extras"> <!-- Show one by one another input field if the user decides to add more participants -->

                        {% for i in extra_range %}
                        <div class="form-group"> 
                            <input type="text" name="p{{ i }}" placeholder="Name {{ i }}"  class="extra hidden"> 
                            <input type="email" name="p{{i}}_email" class="extra hidden form-control"
                        placeholder="Name {{i}} Email">
                        </div>
                        {% endfor %}


                    </div>

                    <div class="restrictions">



                    </div>

                    {% if error %}<p style="color:red">{{ error }}</p>{% endif %}

                    <button class="btn" type="button" id="addBtn">+</button>
                    <button class="btn btn-primary" type="submit">Next</button>
                </div>

            </form>
            </div>
        </div>
        


    <script>
        // All extra inputs names and emails
        const extras = document.querySelectorAll(".extra");

        const addBtn = document.getElementById("addBtn");

        // Each extra participant = 2 inputs (name + email)
        const inputsPerParticipant = 2;

        // How many extra participants exist in the HTML
        const maxExtraParticipants = extras.length / inputsPerParticipant;

        // How many extra participants are currently visible
        let shownExtraParticipants = 0;

        addBtn.addEventListener("click", function () {

            // Figure out which 2 inputs to show next
            const nameIndex = shownExtraParticipants * inputsPerParticipant;
            const emailIndex = nameIndex + 1;

            // Show name + email together
            extras[nameIndex].classList.remove("hidden");
            extras[emailIndex].classList.remove("hidden");

            // Cursor goes to the name field
            extras[nameIndex].focus();

            // Update count
            shownExtraParticipants++;

            // If we just revealed the last possible participant, disable "+"
            if (shownExtraParticipants >= maxExtraParticipants) {
            addBtn.disabled = true;
            return
            }
        });
    </script>


    <style>
    .hidden { display: none; }
    </style>
    {% endblock %}
